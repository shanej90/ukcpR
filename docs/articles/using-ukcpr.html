<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ukcpR">
<title>Using ukcpR • ukcpR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using ukcpR">
<meta property="og:description" content="ukcpR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ukcpR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/using-ukcpr.html">Using ukcpR</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using ukcpR</h1>
            
      
      
      <div class="d-none name"><code>using-ukcpr.Rmd</code></div>
    </div>

    
    
<p>This page will run through the basics of using the package in more
detail than you can get from the readme.</p>
<div class="section level2">
<h2 id="before-you-begin">Before you begin<a class="anchor" aria-label="anchor" href="#before-you-begin"></a>
</h2>
<p>Before you can use this package, you need to already have set up an
account to use the <a href="https://www.metoffice.gov.uk/" class="external-link">Met
Office</a> <a href="https://ukclimateprojections-ui.metoffice.gov.uk/ui/home" class="external-link">UK
Climate Projections (UKCP) data portal</a>. You can do so by <a href="https://ukclimateprojections-ui.metoffice.gov.uk/user/register" class="external-link">signing
up</a>.</p>
<p>Once you have an account, you’ll need to use your API key to make
requests. This can be found on your <a href="https://ukclimateprojections-ui.metoffice.gov.uk/user" class="external-link">My UKCP
page</a> (note you’ll need to be signed in to access this link). One you
have done this, I recommend saving the API key as an environment
variable (named <code>UKCP_API_KEY</code>) in your
<code>.Renviron</code> file. This will save you having to manually
declare it each time you write some code using a function that makes an
API call. The function <code>usethis::edit_renviron()</code> makes it
simple to access the right file.</p>
</div>
<div class="section level2">
<h2 id="sending-a-query">Sending a query<a class="anchor" aria-label="anchor" href="#sending-a-query"></a>
</h2>
<p>Depending on whether you want to get observation or projection data,
you will need to use <code><a href="../reference/start_ukcp_observation_csv_job.html">start_ukcp_observation_csv_job()</a></code> or
<code><a href="../reference/start_ukcp_projection_csv_job.html">start_ukcp_projection_csv_job()</a></code> respectively. Remember that
(at least for now) only certain datasets can be drawn upon:</p>
<ul>
<li>Observations from HadUK-Grid over UK for daily data</li>
<li>Observations from HadUK-Grid over UK for monthly, seasonal or annual
data</li>
<li>Variables from local/regional/global projections over UK for
monthly, seasonal or annual data</li>
</ul>
<p>In either case you will have the option to set multiple parameters
for the query (as per the below example). You might have to do some
playing round/testing via the <a href="https://ukclimateprojections-ui.metoffice.gov.uk/products" class="external-link">user
submission form</a> to understand the accepted values for each parameter
and what they mean. Although there is <a href="https://ukclimateprojections-ui.metoffice.gov.uk/help/api" class="external-link">limited
API documentation</a>, it doesn’t go into the detail needed to define
said parameters.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ukcpR</span><span class="op">)</span></span>
<span></span>
<span><span class="va">example_call</span> <span class="op">&lt;-</span>  <span class="fu"><a href="../reference/start_ukcp_observation_csv_job.html">start_ukcp_observation_csv_job</a></span><span class="op">(</span></span>
<span>  label <span class="op">=</span> <span class="st">"testtthat-good-query"</span>,</span>
<span>  identifier <span class="op">=</span> <span class="st">"LS6_Subset_02"</span>,</span>
<span>  area_type <span class="op">=</span> <span class="st">"point"</span>,</span>
<span>  area_details <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">292500</span>, <span class="fl">72500</span><span class="op">)</span>,</span>
<span>  collection <span class="op">=</span> <span class="st">"land-obs_5"</span>,</span>
<span>  temp_avg <span class="op">=</span> <span class="st">"day"</span>,</span>
<span>  year_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1960</span>, <span class="fl">2021</span><span class="op">)</span>,</span>
<span>  variable <span class="op">=</span> <span class="st">"rainfall"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; No encoding supplied: defaulting to UTF-8.</span></span>
<span></span>
<span><span class="va">example_call</span></span>
<span><span class="co">#&gt; $job_id</span></span>
<span><span class="co">#&gt; [1] "024ee84302f396fb25cdafaac7e897c4"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $req_url</span></span>
<span><span class="co">#&gt; [1] "https://ukclimateprojections-ui.metoffice.gov.uk/wps?service=wps%26request=Execute%26version=1.0.0%26Identifier=LS6_Subset_02%26Format=text/xml%26Inform=false%26Store=false%26Status=false%26DataInputs=Area=point%7C292500.0%7C72500.0;Collection=land-obs_5;DataFormat=csv;JobLabel=testtthat-good-query;TemporalAverage=day;TimeSlice=1960%7C2021;Variable=rainfall"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $status_url</span></span>
<span><span class="co">#&gt; [1] "https://ukclimateprojections-ui.metoffice.gov.uk/status/024ee84302f396fb25cdafaac7e897c4"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="getting-your-results">Getting your results<a class="anchor" aria-label="anchor" href="#getting-your-results"></a>
</h2>
<p>As you can see from the above example, the results of a call are to
return you the job ID (<code>job_id</code>), request URL
(<code>req_url</code>) and most crucially, the status URL
(<code>status_url</code>). The last of these is the URL you use to
actually access your results via the
<code><a href="../reference/download_ukcp_csv_results.html">download_ukcp_csv_results()</a></code> function (regardless of whether
you are looking at observation or projection data).</p>
<p>This function polls the server every five seconds
(<strong>note</strong>: it can take several minutes to complete queries)
to check if your job is finished. When it is, it will download a zip
file to a folder (specified by you) in your working directory and
extract any csv files within. You can optionally keep the zip file. An
example following on from our initial request is below:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_ukcp_csv_results.html">download_ukcp_csv_results</a></span><span class="op">(</span><span class="va">example_call</span><span class="op">$</span><span class="va">status_url</span>, output_folder <span class="op">=</span> <span class="st">"assets"</span><span class="op">)</span></span></code></pre></div>
<p>Note UKCP provides csv file names as timestamps, rather than more
useful data describing what is contained within. Thus you may want to
rename files in some way (possibly a future function here will
programtically rename them based on metadata contained within).</p>
</div>
<div class="section level2">
<h2 id="reading-your-results-into-r">Reading your results into R<a class="anchor" aria-label="anchor" href="#reading-your-results-into-r"></a>
</h2>
<p>Finally, you can read your results into R for further analysis,
visualisation, etc. There are different functions for observation
(<code><a href="../reference/read_observation_csv.html">read_observation_csv()</a></code>) and projection
(<code><a href="../reference/read_projection_csv.html">read_projection_csv()</a></code>). These functions will return a
dataframe which includes some metadata columns in addition to the data
you are actually after. Some processing of the data will be done,
particularly where the data is ‘drawn’ over a custom-defined grid. You
can also choose, where using grid/point-based data, to convert from
northings/eastings to latitude/longitude.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">example_csv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_observation_csv.html">read_observation_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"assets/subset_2023-07-03T09-25-13.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">example_csv</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co">#&gt;   year season month       date spatial_rep         measurement</span></span>
<span><span class="co">#&gt; 1 1960 Winter     1 1960-01-01    5km grid Total rainfall (mm)</span></span>
<span><span class="co">#&gt; 2 1960 Winter     1 1960-01-01    5km grid Total rainfall (mm)</span></span>
<span><span class="co">#&gt; 3 1960 Winter     1 1960-01-01    5km grid Total rainfall (mm)</span></span>
<span><span class="co">#&gt; 4 1960 Winter     1 1960-01-01    5km grid Total rainfall (mm)</span></span>
<span><span class="co">#&gt; 5 1960 Winter     1 1960-01-01    5km grid Total rainfall (mm)</span></span>
<span><span class="co">#&gt;   measurement_units longitude latitude      value</span></span>
<span><span class="co">#&gt; 1                mm -3.518475 50.54236 9.89379428</span></span>
<span><span class="co">#&gt; 2                mm -3.518475 50.54236 1.83870641</span></span>
<span><span class="co">#&gt; 3                mm -3.518475 50.54236 2.11688862</span></span>
<span><span class="co">#&gt; 4                mm -3.518475 50.54236 0.53965386</span></span>
<span><span class="co">#&gt; 5                mm -3.518475 50.54236 0.00258589</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Shane Jackson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
